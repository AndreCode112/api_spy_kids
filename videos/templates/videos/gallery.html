<!DOCTYPE html>
<html lang="pt-BR">
<head>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SpyKids</title>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    {% load static %}
    <link rel="stylesheet" href="{% static 'videos/css/style.css' %}">
    <link rel="icon" type="image/svg+xml" href="{% static 'videos/svg/logo.svg' %}">
  
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="logo">SpyKids - Project</div>
        <div class="user-menu">
            <span class="username">üë§ {{ user.username }}</span>
            <button class="btn-device-info" onclick="openDeviceInfo()" title="Informa√ß√µes do Dispositivo">üñ•Ô∏è</button>
            <button class="btn-settings" onclick="openSettings()">‚öôÔ∏è</button>
            <button class="btn-settings" onclick="modal_Agendar_check_qtd_video_abrir()">üìÖ</button>
            
            <button class="btn-icon notification-trigger" onclick="toggleNotificationPanel()">
                üîî
                <span id="notif-badge" class="badge">0</span>
            </button>

            <form method="post" action="{% url 'logout' %}" style="display: inline;">
                {% csrf_token %}
                <button type="submit" class="btn-logout">Sair</button>
            </form>
        </div>
    </header>

    <!-- Main Content -->
 <main class="main-content">
    <h2 class="section-title">Galeria</h2>

   <div id="search-overlay" class="search-overlay">
    <div class="search-box">
        <div class="search-header">
            <span class="search-icon">üîç</span>
            <input type="text" id="searchInput" placeholder="Digite para buscar..." autocomplete="off">
            <button class="btn-close-search" onclick="toggleSearch()">‚úï</button>
        </div>
        
        <div id="search-results-list" class="search-results-list">
            <div class="search-placeholder">
                Digite o nome do v√≠deo para pesquisar...
            </div>
        </div>
        
        <div class="search-footer">
            <span class="shortcut-hint"><span>ESC</span> para fechar</span>
            <span class="shortcut-hint"><span>‚Üµ</span> para selecionar</span>
        </div>
    </div>
</div>
    <div class="filter-bar">
        <div class="date-inputs">
            <input type="date" id="startDate" class="date-input" title="Data In√≠cio">
            <span class="separator">at√©</span>
            <input type="date" id="endDate" class="date-input" title="Data Fim">
        </div>
        <button class="btn-action btn-sm" onclick="filterByDate()">Filtrar Datas</button>
        <button class="btn-cancel btn-sm" onclick="clearDateFilter()">Limpar</button>
    </div>
    
    <div id="video-list-container">
        {% include 'videos/video_list.html' %}
    </div>

    {% if page_obj.has_next %}
    <div class="pagination-container text-center mt-4">
        <button id="btn-load-more" class="btn-action" onclick="loadMoreVideos({{ page_obj.next_page_number }})">
            Carregar Mais V√≠deos ‚¨á
        </button>
    </div>
    {% endif %}
</main>

<div class="modal" id="videoModal">
    <div class="modal-content player-content">
        <div class="Container-close">
            <button class="btn-close" onclick="closeVideo()">‚úï</button>
        </div>
        
        <div class="video-wrapper">
            <button class="nav-arrow prev-arrow" onclick="playPrev()">‚ùÆ</button>
            <video id="videoPlayer" controls autoplay></video>
            <button class="nav-arrow next-arrow" onclick="playNext()">‚ùØ</button>
        </div>
        
        <div class="player-footer">
            <div class="footer-left">
                <h4 id="playerTitle">T√≠tulo</h4>
                <span id="playerCounter" class="text-muted">1/1</span>
            </div>
        </div>
    </div>
</div>

{{ videos_json|json_script:"initial-video-data" }}


<div class="modal" id="videoModal">
    <div class="modal-content player-content">
        <button class="btn-close" onclick="closeVideo()">‚úï</button>
        
        <div class="video-wrapper">
            <button class="nav-arrow prev-arrow" onclick="playPrev()">‚ùÆ</button>
            
            <video id="videoPlayer" controls autoplay></video>
            
            <button class="nav-arrow next-arrow" onclick="playNext()">‚ùØ</button>
        </div>
        
        <div class="player-footer">
            <h4 id="playerTitle">T√≠tulo do V√≠deo</h4>
            <span id="playerCounter" class="text-muted">1/1</span>
        </div>
    </div>
</div>

    <!-- Video Player Modal -->
    <div class="modal" id="videoModal">
        <div class="modal-content">
            <button class="btn-close" onclick="closeVideo()">‚úï</button>
            <video id="videoPlayer" controls></video>
        </div>
    </div>

    <!-- Delete Confirmation -->
    <div class="overlay" id="overlay"></div>
    <div class="confirm-dialog" id="confirmDialog">
        <h3>Confirmar exclus√£o</h3>
        <p>Tem certeza que deseja excluir este v√≠deo? Esta a√ß√£o n√£o pode ser desfeita.</p>
        <div class="confirm-actions">
            <button class="btn-cancel" onclick="cancelDelete()">Cancelar</button>
            <button class="btn-confirm" onclick="executeDelete()">Excluir</button>
        </div>
    </div>

    <!-- Settings Panel -->
    <div class="settings-panel" id="settingsPanel">
        <div class="settings-header">
            <h2>Armazenamento</h2>
            <button class="btn-close-settings" onclick="closeSettings()">‚úï</button>
        </div>

        <div class="storage-section">
            <div class="storage-label">
                <span>Armazenamento do Servidor</span>
                <span id="loadingIndicator" style="display: none;">
                    <span class="loading-spinner"></span>
                </span>
            </div>

            <!-- Circular Progress -->
            <div class="circular-progress">
                <svg width="150" height="150">
                    <defs>
                        <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="0%">
                            <stop offset="0%" style="stop-color:#e50914;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#ff4757;stop-opacity:1" />
                        </linearGradient>
                    </defs>
                    <circle class="circular-progress-bg" cx="75" cy="75" r="65"></circle>
                    <circle 
                        class="circular-progress-bar" 
                        cx="75" 
                        cy="75" 
                        r="65"
                        id="progressCircle"
                        stroke-dasharray="408.407"
                        stroke-dashoffset="408.407">
                    </circle>
                </svg>
                <div class="circular-progress-text">
                    <div class="circular-progress-percent" id="percentText">0%</div>
                    <div class="circular-progress-label">Utilizado</div>
                </div>
            </div>

            <!-- Storage Stats -->
            <div class="storage-stats">
                <div class="stat-item">
                    <div class="stat-label">Total</div>
                    <div class="stat-value">
                        <span id="totalStorage">--</span>
                        <span class="stat-unit">GB</span>
                    </div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Usado</div>
                    <div class="stat-value">
                        <span id="usedStorage">--</span>
                        <span class="stat-unit">GB</span>
                    </div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Dispon√≠vel</div>
                    <div class="stat-value">
                        <span id="freeStorage">--</span>
                        <span class="stat-unit">GB</span>
                    </div>
                </div>
            </div>

            <div class="progress-bar-container">
                <div class="progress-bar" id="progressBar" style="width: 0%"></div>
            </div>
            <div class="progress-text">
            </div>
        </div>

        
    </div>

    <!-- Device Info Modal -->
    <div class="device-modal" id="deviceModal">
        <div class="modal-header">
            <h2>üì± Informa√ß√µes do Dispositivo</h2>
            <button class="btn-close-modal" onclick="closeDeviceInfo()">‚úï</button>
        </div>
        <button class="btn-update-Device-Info" onclick="UpdateDeviceInfor()">‚ü≤</button>
        <div id="deviceContent">
            <div class="device-loading">
                <span class="loading-spinner"></span>
            </div>
        </div>
    </div>
    
    <div class="edit-modal" id="editTitleModal">
        <div class="edit-modal-content">
            <div class="modal-header">
                <h2>Renomear V√≠deo</h2>
                <button class="btn-close-modal" onclick="closeEditModal()">‚úï</button>
            </div>
            
            <div class="edit-body">
                <label for="newTitleInput">Novo T√≠tulo</label>
                <input type="text" id="newTitleInput" class="elegant-input" placeholder="Digite o novo nome...">
                <input type="hidden" id="editVideoId">
            </div>

            <div class="modal-actions">
                <button class="btn-cancel" onclick="closeEditModal()">Cancelar</button>
                <button class="btn-confirm" onclick="saveNewTitle()">Salvar Altera√ß√µes</button>
            </div>
        </div>
    </div>

    <div id="modal_Agendar_check_qtd_video" class="modal_Agendar_check_qtd_video_overlay">
        <div class="modal_Agendar_check_qtd_video_content">
            <span class="modal_Agendar_check_qtd_video_close" onclick="modal_Agendar_check_qtd_video_fechar()">&times;</span>
            
            <div style="margin-bottom: 25px;">
                <h2 class="modal_title">Capacidade de Grava√ß√£o</h2>
                <p class="modal_subtitle">Defina o per√≠odo de atividade do sistema.</p>
            </div>

            <label class="modal_Agendar_check_qtd_video_label" for="modal_Agendar_check_qtd_video_hora_inicio">Hor√°rio Inicial</label>
            <input type="time" class="modal_Agendar_check_qtd_video_input" id="modal_Agendar_check_qtd_video_hora_inicio" value="{{ config.hora_inicio|date:'H:i'|default:'08:00' }}">

            <label class="modal_Agendar_check_qtd_video_label" for="modal_Agendar_check_qtd_video_hora_fim">Hor√°rio Final</label>
            <input type="time" class="modal_Agendar_check_qtd_video_input" id="modal_Agendar_check_qtd_video_hora_fim" value="{{ config.hora_fim|date:'H:i'|default:'16:00' }}">

            <div class="modal_Agendar_check_qtd_video_actions">
                <button class="modal_Agendar_check_qtd_video_btn_simular" onclick="modal_Agendar_check_qtd_video_processar(false)">Simular</button>
                <button class="modal_Agendar_check_qtd_video_btn_salvar" onclick="modal_Agendar_check_qtd_video_processar(true)">Salvar Altera√ß√µes</button>
            </div>

            <div id="modal_Agendar_check_qtd_video_resultadoArea">
                <h3 style="margin: 0 0 15px 0; color: #fff; font-size: 16px;">An√°lise:</h3>
                <div id="modal_Agendar_check_qtd_video_listaResultados"></div>
            </div>
        </div>
    </div>


    <div id="notification-panel" class="notification-panel">
    <div class="notif-header">
        <div class="notif-title-group">
            <h3>Notifica√ß√µes</h3>
            <span class="notif-count" id="header-count">0 novas</span>
        </div>
        <div class="notif-actions">
            <button class="btn-icon-sm" onclick="clearAllNotifications()" title="Limpar tudo">üóë</button>
            <button class="btn-icon-sm" onclick="toggleNotificationPanel()">‚úï</button>
        </div>
    </div>

    <div class="notif-scroll-area" id="notif-list">
        <div class="empty-notif">
            <span class="empty-icon">üí§</span>
            <p>Nenhuma notifica√ß√£o nova no momento.</p>
        </div>
    </div>
</div>



    <script src="{% static 'videos/js/script.js' %}"></script>
    <script src="{% static 'videos/js/script2.js' %}"></script>
    <script src="{% static 'videos/js/script3.js' %}"></script>
    <script src="{% static 'videos/js/script4.js' %}"></script>
    <script src="{% static 'videos/js/script5.js' %}"></script>
    <script src="{% static 'videos/js/script7.js' %}"></script>
    
    
    
    
</body>
</html>