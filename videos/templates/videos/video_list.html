{% load static %}
<link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">

{% if history_groups %}
    {% for group in history_groups %}
    <div class="date-group mb-4" data-date-group="{{ group.date|date:'Y-m-d' }}">
        <h3 class="date-header sticky-top bg-dark text-white p-2">
            {{ group.date|date:"d" }} de {{ group.date|date:"F, Y" }}
        </h3>
        
        <div class="video-grid">
            {% for video in group.videos %}
            <div class="video-card" data-video-id="{{ video.id }}">
                <div class="video-thumbnail">
                    <img src="{% static 'videos/thumbnail/spykids.jpg' %}" alt="Thumb Padrão" loading="lazy">
                    <div class="play-overlay" onclick="playVideo({{ video.id }}, '{{ group.date|date:'Y-m-d' }}')">▶</div>
                </div>

                <div class="video-info">
                    <div class="video-title-container">
                        <div class="video-title" 
                            id="title-display-{{ video.id }}" 
                            ondblclick="toggleEdit({{ video.id }})"
                            title="Duplo clique para editar">
                            {{ video.title|default:"Sem Título" }}
                        </div>
                        <input type="text" 
                            id="title-input-{{ video.id }}" 
                            class="title-edit-input" 
                            value="{{ video.title|default:'' }}" 
                            onblur="saveTitle({{ video.id }})"
                            onkeydown="if(event.key === 'Enter') saveTitle({{ video.id }})"
                            style="display: none;">
                    </div>

                    <div class="video-meta">
                        {{ video.created_at|date:"H:i" }} • 
                        {% widthratio video.duration.total_seconds 60 1 %} min
                    </div>
                    
                    <div class="video-actions">
                        <button class="btn-ui btn-primary-glass" onclick="playVideo({{ video.id }}, '{{ group.date|date:'Y-m-d' }}')">
                            <i class="ri-play-fill"></i>
                            <span>Assistir</span>
                        </button>

                        <div class="actions-group"> 
                            <button class="btn-ui btn-icon-glass" onclick="executeDownload({{ video.id }})" data-tooltip="Baixar">
                                <i class="ri-download-line"></i>
                            </button>

                            <button class="btn-ui btn-icon-glass" onclick="openEditModal({{ video.id }}, '{{ video.title|escapejs }}')" data-tooltip="Editar">
                                <i class="ri-pencil-line"></i>
                            </button>
                            
                            <button class="btn-ui btn-icon-glass delete" onclick="confirmDelete({{ video.id }})" data-tooltip="Excluir">
                                <i class="ri-delete-bin-line"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endfor %}

{% else %}
    <div class="no-videos">
        <p>Nenhum vídeo foi encontrado no momento.</p>
    </div>
{% endif %}

<script id="updated-video-json" type="application/json">
    {{ videos_json|safe|default:"[]" }}
</script>